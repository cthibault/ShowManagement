DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'ShowManagement.Web.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201409130549594_Initial'
BEGIN
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [dbo].[Shows] (
        [ShowId] [int] NOT NULL IDENTITY,
        [TvdbId] [int] NOT NULL,
        [ImdbId] [nvarchar](max),
        [Name] [nvarchar](max),
        [Directory] [nvarchar](max),
        CONSTRAINT [PK_dbo.Shows] PRIMARY KEY ([ShowId])
    )
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201409130549594_Initial', N'ShowManagement.Web.Migrations.Configuration',  0x1F8B0800000000000400DD5C5B6FE3B8157E2FB0FF41D053B7C85AB9EC0CA681BD8BAC93B4C14E2E1867B67D1BD012ED0823515A89CA2428FACBFAD09FD4BF5052A22EBCE96E5B590C308825F23B87871FC9C3E373FCBFFFFC77FEF38BEF19CF308ADD002DCC93D9B1694064078E8BB60B33C19B1F3E983FFFF4DD9FE6578EFF62FC96B73BA3ED484F142FCC278CC373CB8AED27E88378E6BB7614C4C106CFECC0B7801358A7C7C77FB54E4E2C48204C826518F34F09C2AE0FD30FE4E33240360C7102BCDBC0815ECC9E9337AB14D5B8033E8C4360C385B97A0ABEDD0204B6D08708CFFE01D7B3AC93695C782E200AADA0B7310D8050800126EA9E7F8EE10A4701DAAE42F200788FAF2124ED36C08B211BC679D9BCED888E4FE988ACB2630E6527310EFC8E802767CC4496D8BD97A1CDC284C48857C4D8F8958E3A35E4C2BC7160FAE853E011038802CF975E441B2FCCDB42C4451CDE413CCB3BCE32C8EB88C07D0BA2AFB32AE291D1BADF5141A9D3D931FD77642C130F27115C2098E0087847C643B2F65CFB57F8FA187C85687176B2DE9C7D78F71E3867EF7F8467EFAA23256325EDB807E4D14314843022BAC14D317ED3B0F87E96D8B1E856E99359857089AC0ED3B8052F1F21DAE227B26E4E3F98C6B5FB029DFC0923D767E492C5443AE128211FEF12CF036B0F16EFAD5A99F4FF1AA9A7EFDE8F22F50E3CBBDB74EA05F964E144645D7D825EFA367E72C36C7971F3FD8535BB8E029F7EE6F995BDFDB20A92C8A68309B44D1E41B48598D76E6E95E46D45690A353EAD73D4E9539B6A2AD35BD9940EA8CF4AC845EC7B35E4FAEE566E6BC6D183A88E65DA836A46DF1C19F2FB9232276D2983C850FAD0840AEF33F779BF6C8837089F9D2AEC5931C70A0711FC1B443002183A0F006318A172B936CDF9E3B3B36E96578F71E3573114BC217FB6E2CDA0CD7A1C21976E046D62D2D79125B566FD451812FEA5734BF7817E0B400039F05A782BDEC0950F5C6F0477A08514E2906FDCC887C5287F09C8E60B50679D1F401C93D3D0F93B889F76BE3856D04E2242D715067EB873690F4F01827789BFA6AB607FB2469B9AC76FC135A07BC915A2BD06E37D0CECAF4182AF907349B6FACFD8CE01E9C747D76F0F308A3A17B60DE3F89A90193ACB80DC37871D22749F3AB43BBEF480EBABFD716147FD92372D7D72750BC92FD73453F9E675AA7E0CB62E6AA76ADE54AF6AD6A25155D6ACABAA14AC9DA6ACA55ED1B441A39E59ABD16E3BE90C8D7FDD4961A77FDF197678EFDE813DD465299D3E2A74E767532AE937E025638BEAB51AD24D60FCD590C24E7F35A46A92C7CFAE43BD92164180BC31816FD55E1D5F685E738266FB5E0EDC30F72D7C3F7B806EB95CC47160BBE92A50847F59F08ED79FF8704673242F1B8D180D2403234477E991479E90B19922A9EED125F42086C6859D85C79720B681239B910CC8E9A0587EA22A142BA382BC727F916412A6C3887602F412149395EA222C2F0B17D96E08BC462B093D5B1E6174EC850CF1CD250C21A2021B2DD146B83A08481528E40893D264A1B955615C3D11355EAB6ECE9B5CD872DEA528C55E38D9E03B6B78C9FCB79D10B3DE627B2067BD49DA28A00D681F82A0ECAED29600E2C5656A04156E4C1A8232976A2F04E52D760082F226797304CDAEA86DE75FB8AF4E8D9EFC4579FFC77AADB90EC04DCE1E13A366E67B923E98F480914CCFCB357D095FB0E27246F464F7B398B9BA224528F80A623E6453FABB4A3FD4AA07114954075812AD01947E91A102CABE2C6CE8CCBE47973A4BABB1C3C8F24060EDD0980BD201360FDAD5C2B2834380AD1048C6AEE613541AEAB30E4466B7BABA14232BA824AD9056378D0A8E824DE2CEC70FBC855174415DD9306D1CE92EAE7465606C326A0CD4E0F66A8C940F66742BE5D46CB692CA9BEBE2CF0DB292E07B69AC940F66742B318E361B49E15174F0290699883FFF475A6C7998A438AA8A77732BCB36640FE696262D717E0BC2D045DB4A9A227B62ACB21CC5E50FABEE597B7E8661D9B12279AFD0B6908483086CA1F09688269A5EBB518C2F01066B4083444BC7979A290F66CDF69F8BAC9EBDF224E6E740DE9AFE5D9E89EA3C00EEBC961D1A06754D064A7BA663860A1AA8BB1B347B1478205244FF978197F848EFA4E97B67DF0156FB674F6484B925E82F396192D12457999F8156F323AF8D71E7AA7085FACF971E4267F5DC91ADDA5DE7DCEA51F25857154517FF3AD8FC651EE43873967A9DDDE749DD4D67D53C25AC6A55757A591D4A9EE85545C99FB547C953BDB8F5ED774569BFC675089534AD2A4CE5F164F8A673A3FBF04DBCA874A75E23C26E7675965A5505608F3A6254B27324B0CABBF6A87C025515937FD31E51C892E2962DFFAA8396D55C284EC9EA8B5E781A8BAA5B74D86FA4EC276EE791DEB64756E44155A115AF7B602B7416DFB54755A44A558115AFDB63977953E2D93D61BF497B7D1EEA38658196619E930663371BE3388E572519A50A5479DC118BA59B4860ECF92449A58D360C255516661B462A0D867E1FE2B239F86DA83605458FC9A568705B7D5D8A8A1EAF1B75774A1029E6203629A417B10721C63067F7FDE6FA4829009035318DDC8C8456AF3186FE8C3698AD7EF7969E0BE9A69E37208C733730C6595A92797A7C722AD4564EA7CED18A63C753C44B74C58EFC9CED21C3103D83C87E02919CEF33A016B00495BE4AB9410E7C5998FF4A7B9DA78135FA57FAF8C8B8893F23F7F784BC788C1268FC5BCE5F1EA736AAFEA63FD14AB6F656BDF9E797ACEB91711F9115736E1C0BB6EC33C37C7D5B276DB2AE03B4E956F5D66336C7293873E93ED59891DBB51082AB314B450CAA30CB67EECF3E78F9BE8AD5B58A6C10905429D601AD7735D8DBDD5EB9E22A25AAB03DF6AFA55ABBDD19A6AAA31A440F65ADD42044453DD45878A3985057EFD4074B5BEBE4908F38AD75EA365875ED531FD5B4754F7D3636B1EAA9FDA194F73CA0E3A1B828EF634BDAC919352D4F452A2E19B4D0E502925D1C550DB7DD3F647DC568A7A3A27C6234EC43527BE735135329932813D80E5B1DB1CF82889A6FAAFF50751013C8DC5524131EBEDA61DF5CD305F7279E32DEADA66162646329A687AF5CD837D97441FF8993AD537DC2C4B876A8F3F3C04C6B7D841EBCDA40CE7D14A7559DD09ECD5DE9092ADDB5EC6B1472C35F0784049947991581AB335075C24AB26805964DF442F5A9AFA2E0ACF44012963D560960350C0DB0D27A9424482DEA47D3CD84CC8FA8B5216B532F5693875E279B1D2BB5B2599B7AD99AECEE43544828F3AB55252F0DDB635DBAE75BAA88E046D25080D3E40AD72672BCA50288518CC2AD1E4D22C2DBA97718C524632E9D0EF50D724E0139922BBFCC4CDC82D8DD9610F4779A11B4B9C3B86873833641EE13081AE54D84C0CF2DC4C02127F54584DD0DB031794D43D7E98F63A4E140FA05CA1A3A37E83EC16182C990A1BFF6B8381AF52DEAE4A7451CBCCEF3FB30FD9DA7318640D47469C8FF1EFD92B89E53E87DAD08356920A8D3C202C5742E310D186F5F0BA4BB00B50462E62B7CAD47E8871E018BEFD10A3CC33EBA11FA7D845B60BF9681451D48F344F0669F5FBA601B013F6618657FF29170D8F15F7EFA3F806A5514A05C0000 , N'6.1.1-30610')
END

IF @CurrentMigration < '201409131524134_oathTutorial'
BEGIN
    ALTER TABLE [dbo].[AspNetUsers] ADD [HomeTown] [nvarchar](max)
    ALTER TABLE [dbo].[AspNetUsers] ADD [DateOfBirth] [datetime]
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201409131524134_oathTutorial', N'ShowManagement.Web.Migrations.Configuration',  0x1F8B0800000000000400DD5C5B6FE3B8157E2FD0FF20E8A92DB2562E9DC134B077917192DDA0930BC69E6DDF06B444DBC2489457A232098AFEB23EF427F52F94D49557DD6D2B8B0106092FDF210F3F928747E7E47FFFF9EFF4A717DF339E6118B9019A99679353D380C80E1C176D66668CD73F7C307FFAF18F7F98DE38FE8BF16BDEEE82B6233D513433B718EF2E2D2BB2B7D007D1C477ED308882359ED8816F0127B0CE4F4FFF669D9D5990409804CB30A69F63845D1F26BF905FE701B2E10EC7C0BB0F1CE8455939A95924A8C603F061B403369C998B6DF0FD1E20B0813E4478F20FB89AA49D4CE3CA730119D0027A6BD3000805186032DCCB2F115CE030409BC58E14006FF9BA83A4DD1A7811CCA67159366F3AA3D3733A23ABEC9843D9718403BF25E0D945A6224BECDE49D166A142A2C41BA26CFC4A679D287266DE393029FA1C784401A2C0CBB917D2C633F3BE107115ED1E209EE41D2729E46D48E0BE07E1B7098B786234EE775250EA7C724AFF9D18F3D8C371086708C63804DE89F114AF3CD7FE3B7C5D06DF209A5D9CADD6171FDEBD07CEC5FBBFC28B77EC4CC95C493BAE80143D85C10E86646C705DCCDF342CBE9F25762CBA317D52AD102E91DD611AF7E0E513441BBC25FBE6FC8369DCBA2FD0C94B32727D412ED94CA4130E63F2EB43EC7960E5C1A2DEAA9449FFAF907AFEEEFD20521FC0B3BB49965E904F364E48F6D567E825B5D1D6DDA5DB8B5BEFAF59B3DB30F0E9EF3CBFD2DAAF8B200E6D3A9940DB6409C20DC4FCE8A65649DE4694A650C3D33A471D3FB5E948657A2B9BD20975D909B98843EF867CBCFB95DB9871F422AA6299F6A29AD09A1343AE2F2973D69432884CA50B4DA8F02E6B9FF74BA77887F0C5B9429F8C3A163808E1CF10C11060E83C018C6188CAED5AB7E6CB6767552FAF1AE3CE673114BC213F36E24DAFC37A1821D76E086DA2D2D781253566FDD56E47F897AC2D3D07BA6D0001E4C87BE1AD5803BF043E5C06DFD1FE4946B6EAE3FAA31BE26D2E8B162D5DBFB6EB8D0F5C6F0093A58114F26858BBA10F8B95F818900B02A0D67A7D0251446E6CE717106DF7AEDB05B4E3906CA90506FE6EEFD29EB601820FB1BFA23BF570B2065B9AE5F7E016D0F3EE06D15EBDF13E05F6B720C637C8A184FE82EDB6FC2E000619CE956DC328BA256486CE3C206FE27E171D3D4B8FFD64987BC0F5D56F06E1D4FF9A372DDF0DEA16D2DB41D34CF57EA81AEAA760E3A26643CD9BEA879AB6A81D6AD6ACED502958B391662DF5034D1AD48E336D35D88B2C59A1E19F6409ECF8DF64FD0C8CFD1BD9C77AD025CB4785EEFD6E4A24FD0ABC7868519D764372080CBF1B12D8F1EF866498A4F8D975A855D2C051913726F08DDAAB7D20F57B4E18D9A1B70337CD430B3FCC19A0DB2E575114D86EB20B142EEACCC1C88F9FD87046BDB7319D8DE8B12413234477E995474AC8DC4C91548FE81A7A1043E3CA4E5DF87310D9C091D54826E4B418587EA32A06567A2EF9C1FD459249980E43DA09D047504476AA8BB0BC2D5C64BB3BE0D56A49E8D9F00AA3732F648835D77007111558AB8926C2D58E4A3A80428EB028751A9A5A0CE3AA89A8B15A756B5E67C296EB2E79520EC2C91ADB59C3CBCC7EDB0B31AB3576007256ABA4C900B44EF76310347BAB342580F870191B4185179386A09949751082F21A3B02417995BC3982A64FD4A6EB2FBC57C7464FFEA17CF86BBD525D47E026A78F915133B53D491F4C7AC050A6E7F58A56C217AC789C917166EFB3283375458A50F005C4BCCBA6B4779576A8550D2292A80AB0245A0D28FDD8A2024A3F68D674CEBEF54B9DA5DDD86266B923B0726A9909D2023677DA55C266178700CB1048C666631E9886FAC80891D98D9E2EC5CC0A2A493BA4D14B83C151B0493CF9F88937508ACEA92B2BA68921DDC6946626962D4685826ACC5E8D92F2C90CAEA59C9AF55A5259736DECB95E5A126C2F8D96F2C90CAEA58CA3F54A5258142D6C8A5E2AE2EFFF81365BEE2629AEAAA26E6AA5119159C1D4D2844E4EEFC16EE7A20D134A9995188B348E72FEC3A27D64A19F625876A408302C465B48C241083650A825A2C9486FDD30C2D7008315A04EA2B9E34BCD9417B3E6F8CF45B277AFBC88F93D90B7A63F9777A23A5681BBAF65832683BA2513A53D933943050DD4DD0D1AE10A3C102ABCFFF3C08B7DA437D2F4BDD36F806CFFB44446985AC2F825234C529A642AF32BD0687DE4BD31EC5A15A650F7F5D243E8B49E1BB2ACDE75C6AD1E25F775B1283AFFD7D1D62FB5208759B3C4EA6CBF4EEA6E3AADE6616BAC56D52170552879301A8B92973547C9C3D1B8FDEDB74569BEC775084C28190BC3148F866F3A33BA0BDFC4874A7BEAD522ECE7542FC3BF588CB2B4C5CAB3F15DDCDAB315CDF1B2A02F16292B6A89C1C40D49604C5D73543EB48BC5E46B9A230AF15BDC81C257B518251BA5C50D92ADE884A7D1A8BA458B93508ACBE2CE44A9B639B222428B85565477C0568C59AC6B8EAA08E2628115D5CDB1CB882ED1AA18B145A77DD8F735E95217503F9B4E83B19F237B1893900993618198E2965859208C0496958F92545A3F485F52A50EC07EA4D260E8CF212ECE843F862A8363F4985CF00877D45705CFE8F1DA5177AF0491BC216293427AE11511BC1FD3CC13519F5D2AB926D226A691AB91D0EA35C2D09FD00693C56FDEDC73213DD4F3068471EE1A46380D9832CF4FCFCE85CCD4F164895A51E4780A4F8E2E55945FB303C43EA26710DA5B10CA91483D32294B50E923CF1D72E0CBCCFC57D2EB3271F9D19F92E213E32EFA82DCDF6252B10C6368FC5B8EAC1E26B3ACDA0731D23CC0E65ABDFBE7D7B4EB89F118921D73699C0ABAECB2C27C7660ABD1A45D7B8CA65DCE6087D51C265DCFA5E7546DAC70DB140D2E432F11D12B3F2F5FB93FF9E0E5CF2C56DB1CBC5E40529E5D0BB4CEB9746FF7781553D3FAE95E4E3F7348114ED273DA4171E968CAD90AC776F7ECB395DB9EF9AACCB35EAA536697F5425464900D8537880A7519625DB0B4D9615DE9A7CE16EB32346DA658970357CC136B7E59E63D8F6810291EF087382AF772778ECB8292D2717A6D7439E5661F5768CD2BFC77999132D8ADAD4838190CFB98D4DE7B96C958124BCA90BFE3E6931C3285A4E2DBFEEF2A736404B1CE8AF0CBE3E7871C9A6BBA8F0E230FB26F97053232B26541B9C7CFF53834D9741F23464EB656191D23E3DAB1EECF2333ADF1157AF4FC0C395A545C56750A40BA76A525A834D7D2CF3BE485BF0A0809528B324D9B57C7ECEA849564D10A2C9BE885EA838545C169B286242C2D5609C8B23E6A60A5FD2849905A54CFA69D0A333BA25287599B6AB19AC8FD2AD9D9B552293B6B532D5B130F7F8C9C126544BA2A49A8E678AC0A907D4B3924DC4C6A5296EA4CE1CA0093B79432328852B8DDA30990783B192283A864C8ADD32223448E75205732F3F7B6895910B99B1282FEF56D046DEE322EDADCA17590DB04C288F22682E3E71E62E0909BFA2AC4EE1AD8985453D775F2E744127720FD80B282CE1D7A8CF12EC664CAD05F799C1F8DDA1655F293B4177ECCD3C75DF297B186980219A64B5DFE8FE863EC7A4E31EE5B85AB4903418D96CC514CD7125387F1E6B5407A085043A04C7D85ADB584FECE2360D1235A8067D8656C847E9FE006D8AFA563510752BF10BCDAA7D72ED884C08F328CB23FF99570D8F15F7EFC3FA40EA088765E0000 , N'6.1.1-30610')
END

